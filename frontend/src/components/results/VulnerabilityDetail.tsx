import React from 'react';
import RiskBadge from '../common/RiskBadge';
import Button from '../common/Button';
import type { VulnerabilityInfo } from '../../types';

interface VulnerabilityDetailProps {
    vulnerability: VulnerabilityInfo;
}

const VulnerabilityDetail: React.FC<VulnerabilityDetailProps> = ({ vulnerability }) => {
    return (
        <div className="bg-white rounded-lg shadow-sm p-6">
            <div className="flex justify-between items-start mb-4">
                <h3 className="text-lg font-medium text-gray-700">{vulnerability.title}</h3>
                <RiskBadge level={vulnerability.severity} />
            </div>

            <div className="grid grid-cols-2 gap-4 mb-4 text-sm">
                <div>
                    <span className="text-gray-500">文件路径:</span>
                    <p className="font-mono">{vulnerability.file_path}</p>
                </div>
                <div>
                    <span className="text-gray-500">行号:</span>
                    <p className="font-medium">{vulnerability.line_number}</p>
                </div>
                {vulnerability.cwe_id && (
                    <div>
                        <span className="text-gray-500">CWE ID:</span>
                        <p className="font-medium">{vulnerability.cwe_id}</p>
                    </div>
                )}
                <div>
                    <span className="text-gray-500">置信度:</span>
                    <p className="font-medium">{(vulnerability.confidence * 100).toFixed(0)}%</p>
                </div>
            </div>

            <div className="mb-4">
                <h4 className="text-sm font-medium text-gray-600 mb-2">问题描述</h4>
                <p className="text-gray-700 bg-gray-50 p-3 rounded-md">{vulnerability.description}</p>
            </div>

            {vulnerability.remediation && (
                <div className="mb-4">
                    <h4 className="text-sm font-medium text-gray-600 mb-2">修复建议</h4>
                    <p className="text-gray-700 bg-gray-50 p-3 rounded-md">{vulnerability.remediation}</p>
                </div>
            )}

            {vulnerability.code_snippet && (
                <div className="mb-4">
                    <h4 className="text-sm font-medium text-gray-600 mb-2">受影响的代码</h4>
                    <pre className="text-xs overflow-x-auto p-3 bg-gray-800 text-gray-200 rounded-md">
                        {vulnerability.code_snippet}
                    </pre>
                </div>
            )}

            {vulnerability.cve_references && vulnerability.cve_references.length > 0 && (
                <div>
                    <h4 className="text-sm font-medium text-gray-600 mb-2">CVE 参考链接</h4>
                    <ul className="list-disc list-inside text-sm">
                        {vulnerability.cve_references.map((cve, index) => (
                            <li key={index} className="text-blue-500 hover:underline">
                                <a href={cve.url || '#'} target="_blank" rel="noopener noreferrer">
                                    {cve.cve_id} - {cve.description}
                                </a>
                            </li>
                        ))}
                    </ul>
                </div>
            )}
        </div>
    );
};

export default VulnerabilityDetail;
